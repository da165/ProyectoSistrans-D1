CREATE TABLE USUARIO (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY, 
    NOMBRE VARCHAR2(100) NOT NULL,
    EMAIL VARCHAR2(100) NOT NULL UNIQUE, 
    CELULAR VARCHAR2(20), 
    CEDULA VARCHAR2(20) NOT NULL UNIQUE, 
    FECHA_REGISTRO DATE DEFAULT SYSDATE NOT NULL
);
CREATE TABLE USUARIO_CONDUCTOR (
    ID NUMBER PRIMARY KEY,
    ACTIVO NUMBER(1) DEFAULT 1 NOT NULL CHECK (ACTIVO IN (0, 1)), 
    CONSTRAINT FK_CONDUCTOR_USUARIO FOREIGN KEY (ID) REFERENCES USUARIO(ID)
);
CREATE TABLE USUARIO_SERVICIO (
    ID NUMBER PRIMARY KEY,
    TARJETA_NUMERO VARCHAR2(20), 
    TARJETA_NOMBRE VARCHAR2(100),
    TARJETA_VENCIMIENTO DATE, 
    TARJETA_CVV NUMBER(4),
    CONSTRAINT FK_USER_SERVICIO_USUARIO FOREIGN KEY(ID) REFERENCES USUARIO(ID)
);
CREATE TABLE PUNTO_GEOGRAFICO (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    NOMBRE VARCHAR2(100),
    DIRECCION VARCHAR2(255) NOT NULL,
    LATITUD NUMBER(10, 7) NOT NULL, 
    LONGITUD NUMBER(10, 7) NOT NULL
);
CREATE TABLE VEHICULO (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ID_USUARIO_CONDUCTOR NUMBER NOT NULL,
    TIPO VARCHAR2(20) NOT NULL CHECK(TIPO IN('CARRO','CAMIONETA','MOTOCICLETA')),
    MARCA VARCHAR2(50) NOT NULL,
    MODELO VARCHAR2(50) NOT NULL,
    COLOR VARCHAR2(30) NOT NULL,
    PLACA VARCHAR2(10) NOT NULL UNIQUE, 
    CIUDAD_EXPEDICION VARCHAR2(50) NOT NULL,
    CAPACIDAD_PASAJEROS NUMBER(2) NOT NULL,
    ACTIVO NUMBER(1) DEFAULT 1 NOT NULL CHECK (ACTIVO IN (0, 1)),
    NIVEL VARCHAR2(20) CHECK(NIVEL IN('ESTANDAR', 'COMFORT', 'LARGE')), 
    CONSTRAINT FK_VEHICULO_CONDUCTOR FOREIGN KEY (ID_USUARIO_CONDUCTOR) REFERENCES USUARIO_CONDUCTOR(ID)
);
CREATE TABLE CIUDAD (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    NOMBRE VARCHAR2(100) NOT NULL UNIQUE
);
CREATE TABLE SERVICIO (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ES_PASAJEROS NUMBER(1) DEFAULT 0 NOT NULL CHECK (ES_PASAJEROS IN (0, 1)),
    ES_COMIDA NUMBER(1) DEFAULT 0 NOT NULL CHECK (ES_COMIDA IN (0, 1)),
    ES_MERCANCIA NUMBER(1) DEFAULT 0 NOT NULL CHECK (ES_MERCANCIA IN (0, 1))
);

CREATE TABLE VIAJE (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ID_USUARIO_SERVICIO NUMBER NOT NULL,
    ID_USUARIO_CONDUCTOR NUMBER NOT NULL,
    ID_VEHICULO NUMBER, 
    ID_PUNTO_INICIO NUMBER NOT NULL,
    ID_PUNTO_FIN NUMBER NOT NULL,
    HORA_INICIO TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL, 
    HORA_FIN TIMESTAMP WITH TIME ZONE,
    DISTANCIA_KM NUMBER(10, 2), 
    COSTO_TOTAL NUMBER(10, 2),
    CONSTRAINT FK_VIAJE_USUARIO_SERVICIO FOREIGN KEY (ID_USUARIO_SERVICIO) REFERENCES USUARIO_SERVICIO(ID),
    CONSTRAINT FK_VIAJE_USUARIO_CONDUCTOR FOREIGN KEY (ID_USUARIO_CONDUCTOR) REFERENCES USUARIO_CONDUCTOR(ID),
    CONSTRAINT FK_VIAJE_VEHICULO FOREIGN KEY (ID_VEHICULO) REFERENCES VEHICULO(ID),
    CONSTRAINT FK_VIAJE_PUNTO_INICIO FOREIGN KEY (ID_PUNTO_INICIO) REFERENCES PUNTO_GEOGRAFICO(ID),
    CONSTRAINT FK_VIAJE_PUNTO_FIN FOREIGN KEY (ID_PUNTO_FIN) REFERENCES PUNTO_GEOGRAFICO(ID)
);


CREATE TABLE REVISION (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ID_VIAJE NUMBER NOT NULL,
    CALIFICACION NUMBER(1) NOT NULL CHECK (CALIFICACION BETWEEN 1 AND 5), 
    COMENTARIO VARCHAR2(500), 
    FECHA DATE DEFAULT SYSDATE NOT NULL,
    EMISOR_TIPO VARCHAR2(20) NOT NULL CHECK (EMISOR_TIPO IN('USUARIO_SERVICIO','CONDUCTOR')),
    CONSTRAINT FK_REVISION_VIAJE FOREIGN KEY (ID_VIAJE) REFERENCES VIAJE(ID)
);

CREATE TABLE DISPONIBILIDAD (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ID_USUARIO_CONDUCTOR NUMBER NOT NULL,
    ID_VEHICULO NUMBER,
    DIA_SEMANA NUMBER(1) NOT NULL CHECK (DIA_SEMANA BETWEEN 1 AND 7), 
    HORA_INICIO TIMESTAMP NOT NULL,
    HORA_FIN TIMESTAMP NOT NULL, 
    CONSTRAINT UQ_DISPONIBILIDAD UNIQUE (ID_USUARIO_CONDUCTOR, DIA_SEMANA, HORA_INICIO, HORA_FIN),
    CONSTRAINT FK_DISPO_CONDUCTOR FOREIGN KEY (ID_USUARIO_CONDUCTOR) REFERENCES USUARIO_CONDUCTOR(ID),
    CONSTRAINT FK_DISPO_VEHICULO FOREIGN KEY (ID_VEHICULO) REFERENCES VEHICULO(ID)
);